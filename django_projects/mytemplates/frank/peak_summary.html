{% extends 'frank/frankbase.html' %}

{% load staticfiles %}

{% block title %}{% endblock %}

{% block body_block %}

        <h4>{{peak}}</h4>
	<p>Mass: {{peak.mass}}</p>
	<p>Retention Time: {{peak.retention_time|floatformat:2}}</p>
	<p>Intensity: {{peak.intensity|floatformat:2}}</p>
	<p>Number of Fragments: {{number_of_fragments}}</p>
	</br>
	{% if preferred_annotation %}
	<p>Preferred Annotation: {{preferred_annotation.compound.name}}</p>
	<p>Preferred Annotation Formula: {{preferred_annotation.compound.formula}}</p>
	<p>Selected By: {{peak.preferred_candidate_user_selector}}</p>
	<p>Last Updated: {{peak.preferred_candidate_updated_date}}</p>
	</br>
	{% else %}
	<p>No Specified Preferred Annotation</p>
	{% endif %}

	<p>MS2 Fragment Spectrum</p>     
	{% if fragmentation_peak_list %}

		<div>
			<img src="/frank/my_fragmentation_sets/{{peak.fragmentation_set.slug}}/{{peak.slug}}/msn_spectra_plot.png">
		</div>
		</br>
		<table>
		<tr>
		<th>Fragment Identifier</th>
		<th>Mass</th>
		<th>Retention Time</th>
		<th>Intensity</th>
		</tr>

		{% for fragment in fragmentation_peak_list %}
		<tr>
		<td><a href="/frank/my_fragmentation_sets/{{fragment.fragmentation_set.slug}}/{{fragment.slug}}">{{fragment}}</a></td>
		<td>{{fragment.mass|floatformat:2}}</td>
		<td>{{fragment.retention_time|floatformat:2}}</td>
		<td>{{fragment.intensity|floatformat:2}}</td>
		</tr>
		{% endfor %}
		</table>
	{% else %}
		<h1>No peaks to display</h1>
	{% endif %}
	<br/>
	<h3>Candidate Annotations</h3>
	 {% if candidate_annotations %}
	  {% for annotation_query,annotations in candidate_annotations.items %}
	  	<h4>{{annotation_query.name}}</h4>
	  	{% if annotation_query.parent_annotation_query %}
	  		<p>Parent: {{annotation_query.parent_annotation_query.name}}</p>
	  	{% endif %}
		<table border=1>
		<tr>
		<th>Compound Title</th>
		<th>Compound ID</th>
		<th>Compound Formula</th>
		<th>Compound Mass</th>
		<th>Confidence Value</th>
		<th>Additional information</th>
		<th>Mass Differential</th>
		<th></th>
		</tr>
		{% for annotation in annotations %}
		<tr>
		<td>{{annotation.compound.name}}</td>
		<td>{{annotation.compound.id}}</td>
		<td>{{annotation.compound}}</td>
		<td>{{annotation.compound.exact_mass|floatformat:4}}</td>
		<td>{{annotation.confidence|floatformat:3}}</td>
		<td>{{annotation.additional_information}}</td>		
		<td>{{annotation.difference_from_peak_mass|floatformat:3}}</td>
		<td><a href="/frank/my_fragmentation_sets/{{peak.fragmentation_set.slug}}/{{peak.slug}}/{{annotation.id}}/specify_preferred_annotation">Prefer Annotation</td>
		</tr>
		{% endfor %}
		</table>
	  {% endfor %}
	{% else %}
		<h1>No annotations to display</h1>
	{% endif %}

	<table>	
	<tr><td><a href="/frank/">Home</a></td></tr>
	</table>	

{% endblock %}
